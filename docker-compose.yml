version: '3.5'

networks:
  valprenet:
    driver: bridge
    name: valprenet
    ipam:
      driver: default
      config:
      -
        subnet: 10.0.0.0/8

services:
  redis:
    image: "${IMAGE_REDIS}"
    ports:
    - '6379:6379'
    networks:
    - valprenet
    container_name: redis

  indypool:
    image: "${IMAGE_INDYPOOL}"
    ports:
    - "9701-9708:9701-9708"
    networks:
    - valprenet
    container_name: indypool

  indyproxy:
    depends_on:
    - indypool
    image: "${IMAGE_INDYPROXY}"
    ports:
    - "4000:4000"
    networks:
    - valprenet
    environment:
    - TEST_POOL_IP=indypool.valprenet
    container_name: indyproxy

  verifier:
    depends_on:
    - indyproxy
    - redis
    image: "${IMAGE_VERIFIER}"
    ports:
    - "8080:8080"
    networks:
    - valprenet
    environment:
    - REDIS_URL=redis://redis.valprenet:6379/0
    - INDYPROXY_HOST=indyproxy.valprenet
    - INDYPROXY_PORT=4000
    - INDYPROXY_PROTOCOL=http
    - SM_CLIENT_ID=${SM_CLIENT_ID}
    - SM_CLIENT_SECRET=${SM_CLIENT_SECRET}
    container_name: verifier

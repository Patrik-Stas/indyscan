/* eslint-env jest */

import { esTransform } from '../../../src/es/es-transformations'

const txCredDef = {
  'auditPath': [
    '2ZgKe9ATBswUceTQBBhjopKHkLmYFL1H5EaoLwT2ipe2',
    'EgZGF9ppv3ZYmWjm9nHiWtJieYLzvwfZLXwKKeTTB7zT',
    'Gt86EjjQKVAXEPU7nhcitnEmdhjDctnDJPsdimWSykDA',
    '8E8sutxfBfec9Wrd2sc66ium2CFxjByTWDB3BVnSa2jL',
    'HRxju2xGC2XPK7wm45NKdz2JntJsusP2dgomkRC62sP6',
    'GcMJQzo38az51VYGZY8rYC8eN7nyR8cuyiHhNZRHpLub',
    '9C38naSmZ2hqnq7yjwj75qED3L8AkmjrUUjqWRecddLS',
    'B2e5Lev63eo4B4UYqi3BdFtDqVcLLzs6TapQ4Bd8bWVs',
    'EmviEJYzYq4UsT7RvR2H8Ypb7mhKMabhz45LWasgERN'
  ],
  'ledgerSize': 74634,
  'multi_signature': {
    'participants': [
      'trusted_you',
      'regioit01',
      'DigiCert-Node',
      'SovrinNode',
      'Absa',
      'dativa_validator',
      'Swisscom',
      'lab10',
      'sovrin.sicpa.com',
      'EBPI-validation-node',
      'cynjanode'
    ],
    'signature': 'RDe6UTUy3U696YousucsJL6DbMY3wf4ThUC9z1MU3SSLyjTVPeJEp9XFPBRsE6GXZR3xHtfL1pj21ydysvqUchng899Qg8t7Dz6GLLeqNjzP74XN8tHBfxXDMyAnzADDM6Xc1v3c4QKdxfU8w3XtJWhQbdTiPPdfpCccKVFCHPs71y',
    'value': {
      'ledger_id': 1,
      'pool_state_root_hash': 'HNxHwTWsadJeLfCTkjtM5rzkePcvwvjKXWGsD5o9T5wB',
      'state_root_hash': '47EQbwdbdEKYnkWe1GYmEHnfQyhkAZs8vuCvJmd4Hu4n',
      'timestamp': 1571049045,
      'txn_root_hash': 'DsyCws7GEvVS976JdPDsAwYD7vLbxQaCa5Zu12XYBAzy'
    }
  },
  'reqSignature': {
    'type': 'ED25519',
    'values': [
      {
        'from': 'GJw3XR52kQEWY44vNojmyH',
        'value': '2QgiPM37KeYaMEF4LMyUGkKuDenB35TrMNHfBy27HT4YWfNREWHtAb8F4WvMfaj8mHUYZAzymQgMzcEmbTRSZbKS'
      }
    ]
  },
  'rootHash': 'DsyCws7GEvVS976JdPDsAwYD7vLbxQaCa5Zu12XYBAzy',
  'txn': {
    'data': {
      'data': {
        'primary': {
          'n': '123239739199212395593412875776471405369782150583431819071634847075835954684547090746666003765154057769582088435795882123638921367720268572220098143106072957020365877116797123066131557583310583856010796774088846901642431964887521432206712536774735723704323321526903869548847054250444579971585489900450008029977783777408978277441317683958334092415640981955077980130014167139893109050948059424268074822750925480105680333047242743356623767143649573700692419654647409115757937879453137579632966949056945536289681069261321936939439443248593739966311165451231438565510668642143737354838444120714251308530672812958411771449017',
          'r': {
            'bank_account_number': '92351286183858943236166243985363947470055519973788852136109130995388085568004459506293405322754953586447996949056421135860900473815442097310004132953345305970296174261071387747353731471109310044081042602896949685698381635316161238837866827894447565933859924770896049770450935780847383341345385554361968524122193531334206425324073609200036368480188361418126973452913541761951869709015364096910735506015764288317870863620595410543794487993445518689902870253482793592430171898067294499522094924006442631433316126159832712758156691438106427796954267700116251511388494933427312601280050887160999608275933585068170842233229',
            'bank_account_type': '106857681094384713818376568265504307078698485094688297665753120000353463899050998993169116742219285780833505454476736014553193069836452253603342011002289080824395456462988703407422509369213820771199406563812220927925837729648245950448233647739437310332099749545439029964020740641907187119431211624683959699437910335420149860134825731801169797285059619654838256909443819468018285397647147413191465143700819048396661664417402528883231282096017578758990253019746241571759042356018334885150234105787023588024747441488715139016180587084560803122203977313300370463818365606013113065185696010840372097995426399569850937965530',
            'master_secret': '23155174735288527233799825808633495722355735107684699578144874857723045605500338973506599252053204621870774676945525803446257910254424627108191109137327826929657740596231612332536482540890843170524137273529271998066689384566512586883793456898313155911210105495151750902321157872317262239600040959671912823965487928203036828949248277692071353426909471613318759361759792339135467985020309924369176782409620057989388716654309849049761934992742529767987388226819129426218308363711934494901077792755046194800143170268422176108913850587794481965231113185455584736746229626367038773836992833874880230714493017585564173558678'
          },
          'rctxt': '96644159799901632185812197649512667021011791899800946409795178133137340380228103258809600620087589208972003701438847546957388774721972137830680161174975216211158471853561037783680631495452317061812521902943184389043468171598817453743297848661620610874947956329217920516112245665391214365633905666753065689804913854600947321354148717988153359071194458122319742196419747279236456717666157863537590477950157551235759355872543018338839834907665153342908778297631573381136527009356252880515833708055914726978919125396819679238980814487675591244506113431036784709539940697297604114291185880516073753361163230756470852657791',
          's': '45713569629829281420029707655921341967493613144871897533004948538633422512183123578256347445669892207791554725704138296483525321623033444784770688545216809201163661433203455186014646765434813785297144328932561632445245983417948276448306027633171273114789238635888145686955870404287509141181103763193838465334737055263089279540035099391391227275637839113947251339085599132038664558839028371449117880456651242740651974144524930240972048164565053909755165810656378892336469461133257143587755269348120932824943042490387105616809680790752597124349524668951925948442048747887883221133368284550819267162212297841571085675542',
          'z': '26085078111281698825335164693323210338554306448200518930878978619962024957258055174528204175999153112207806024023569788633188744499670684973043001960288465467902093817273350147433067296411621334712325189190582690494818076089431161234754829932545096105726125842362838607985943886570497497102340093442970910497576034442182966237614748309677768663094562178984781037836544977219650023854344497749278793015105581234835405668204533878739689059800571499788746173279610277926420411756270215498788142928566183171868037087082659260536865048708897633148882911025004115350056726889450554894402613654380444908343383096830726447043'
        }
      },
      'ref': 74631,
      'signature_type': 'CL',
      'tag': 'tag1'
    },
    'metadata': {
      'digest': '40f456ad9534cae1fa855e8c1cfd359d52ac09a6a5cf43818c7ec1363f14ef22',
      'from': 'GJw3XR52kQEWY44vNojmyH',
      'payloadDigest': '0dcd56a94fc88267371be04e491a0728c203f199ab3746341560c1cc43aa47d3',
      'reqId': 1571049012946704400
    },
    'protocolVersion': 2,
    'type': '102'
  },
  'txnMetadata': {
    'seqNo': 74632,
    'txnId': 'GJw3XR52kQEWY44vNojmyH:3:CL:74631:tag1',
    'txnTime': 1571049024
  },
  'ver': '1'
}

const txNym = {
  'auditPath': [
    'LdTquzhdp92MPsSKkW2LjRPQ6jYf8CvKBcRTWbmmAoL',
    '8GbV9MJ9wxrbLwpFafRHtkPHFd8iyTDFM9KuCCRn6hni',
    'HwRdB59DDEMSmEymu7ubPbnyozi5o1zWRHnBnpwhSzRV',
    '2xAwC6z9b1oKdNRkhRrJbC1AmnoLxh7CF4cjQwAsNb95',
    'FgQ3QyZGF3m5UR3bXSVks8GcbCJuqPBaHcG9aevZQawg',
    'ET5fuqRcR99Vmry1F89PTQofYiH2LAJiMvPsrjkJNqug',
    'HxQPDqHLj72xX9Aam7JgQCPgMege1RqMbh5vZMNriamY',
    'HAgA973B1TsAjMH2q5ak7L8AhnF5o3urofCfFEWWkwCP',
    'GjS83bEQfRXSfLiY9qcs7SaMDE3kxnfmpz4xgYSCh9Z7',
    'B2e5Lev63eo4B4UYqi3BdFtDqVcLLzs6TapQ4Bd8bWVs',
    'EmviEJYzYq4UsT7RvR2H8Ypb7mhKMabhz45LWasgERN'
  ],
  'ledgerSize': 79487,
  'reqSignature': {
    'type': 'ED25519',
    'values': [
      {
        'from': '3hzaM4LfEeoZ4wpx324Hjt',
        'value': '4Zjk1SYF4umemW5hvHQqWinPymfdQaRgsP2d84G4uktgym7GMJmKUo1o3RfiAv8nRSW7TPEYyA7cg18i7tCBJW5Y'
      }
    ]
  },
  'rootHash': 'AtWskmdDGLwxVMAbjWXRj1qw4QEDvNRLRaqFeMUAUUDs',
  'txn': {
    'data': {
      'dest': 'SRySMy5GeztFpbZn4Sdnat',
      'verkey': 'EruokZZEVassemCXwLC1NUTWaPpR2jLhMZpDoP89mkX8'
    },
    'metadata': {
      'digest': '5b1eb7b3213e60bfd7460983ab976e8761e7be9d807a5b150f2c99d30c868a88',
      'from': '3hzaM4LfEeoZ4wpx324Hjt',
      'payloadDigest': '7bc13dcf720f48d27a857d8f7a550f20af6ce8cf9d1695a87e02c869d6e17922',
      'reqId': 1574796721776572200
    },
    'protocolVersion': 2,
    'type': '1'
  },
  'txnMetadata': {
    'seqNo': 79487,
    'txnId': '0105c4352dafa02b359463891140a953b5c09bfe87204cd5de8e64466c6ce4cb',
    'txnTime': 1574796721
  },
  'ver': '1'
}

describe('esTransform', () => {
  it('should have basic field after transform', async () => {
    let transformed = await esTransform(txNym)
    expect(transformed.original).toBeDefined()
    expect(transformed.transformed).toBeDefined()
  })

  it('should transform cred def', async () => {
    let transformed = await esTransform(txCredDef)
    expect(transformed.original).toBeDefined()
    expect(transformed.transformed.txn.data.schema.attr_names).toBeDefined()
    expect(transformed.transformed.txn.data.schema.seqno).toBeDefined()
    expect(transformed.transformed.txn.data.schema.id).toBeDefined()
    expect(transformed.transformed.txn.data.schema.name).toBeDefined()
    expect(transformed.transformed.txn.data.schema.version).toBeDefined()
    expect(transformed.transformed.txn.data.schema.from).toBeDefined()
  })
})
